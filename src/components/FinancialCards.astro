---
//@ts-nocheck
import financialData from "@data/financialProjections.json";
import MoneyIcon from "@icons/money.svg?raw";
import CardIcon from "@icons/card.svg?raw";
import LawIcon from "@icons/law.svg?raw";
import CalIcon from "@icons/cal.svg?raw";

const iconMap = {
  money: MoneyIcon,
  card: CardIcon,
  law: LawIcon,
  cal: CalIcon,
};
---

<div class="card-scroller">
  <ul>
    {
      financialData.values.map((financial, index) => (
        <li data-card={index}>
          {financial.icon && iconMap[financial.icon] && (
            <div class="icon-wrapper">
              <span class="icon" set:html={iconMap[financial.icon]} />
            </div>
          )}
          <h3>{financial.title}</h3>
          <p>{financial.description}</p>
        </li>
      ))
    }
  </ul>
</div>

<script>
  // Javascript udarbejdet delvist af Copilot
  // scroll-state queries ville ikke virke optimalt.
  // @ts-nocheck
  const scroller = document.querySelector(".card-scroller");
  const cards = document.querySelectorAll(".card-scroller ul li");

  if (scroller && cards.length) {
    const updateActiveCard = () => {
      const scrollerRect = scroller.getBoundingClientRect();
      const scrollPaddingLeft = parseInt(getComputedStyle(scroller).scrollPaddingLeft) || 0;
      const snapPoint = scrollerRect.left + scrollPaddingLeft;

      let closestCard = null;
      let closestDistance = Infinity;

      cards.forEach((card) => {
        const cardRect = card.getBoundingClientRect();
        const distance = Math.abs(cardRect.left - snapPoint);

        if (distance < closestDistance) {
          closestDistance = distance;
          closestCard = card;
        }
      });

      // Reset alle kort - fjern class
      cards.forEach((card) => {
        card.classList.remove("active-card");
      });
      // Tilf√∏j class til aktivt kort
      if (closestCard && closestDistance < 50) {
        closestCard.classList.add("active-card");
      }
    };

    scroller.addEventListener("scroll", updateActiveCard);
    scroller.addEventListener("scrollend", updateActiveCard);

    setTimeout(() => {
      updateActiveCard();
    }, 100);

    window.addEventListener("resize", updateActiveCard);
  }
</script>

<style>
  @layer components {
    .card-scroller {
      container-type: inline-size;
      container-name: cards;
      padding-inline: max(1rem, calc((100vw - 75rem) / 2));
      padding-bottom: 2rem;
      overflow-x: auto;
      overflow-y: visible;
      scroll-snap-type: x mandatory;
      scroll-padding-inline: max(1rem, calc((100vw - 75rem) / 2));
      scrollbar-width: none;
      min-height: calc(var(--card-height-active) + var(--flow-lg) * 2 + 2rem);

      &::-webkit-scrollbar {
        display: none;
      }
    }

    ul {
      display: flex;
      align-items: flex-start;
      gap: var(--flow-md);
      margin: 0;
      padding: 0;
      padding-block: var(--flow-lg);
      list-style: none;
      width: max-content;

      &::after {
        content: "";
        display: block;
        width: calc(100vw - 300px - var(--flow-md));
        min-width: max(1rem, calc((100vw - 75rem) / 2));
        flex-shrink: 0;
      }
    }

    li {
      background-color: var(--secondary-light-grey);
      border-radius: var(--radius-md);
      padding: var(--flow-lg) var(--flow-md);
      display: flex;
      flex-direction: column;
      gap: var(--flow-md);
      width: var(--card-width);
      height: var(--card-height);
      flex-shrink: 0;
      scroll-snap-align: start;
      scroll-snap-stop: always;

      h3 {
        font-size: var(--h3);
        font-weight: 600;
        line-height: 1.16;
        color: var(--primary-black);
        margin: 0;
      }

      p {
        font-size: var(--p);
        line-height: 1.475;
        color: var(--primary-black);
        margin: 0;
      }

      &.active-card {
        background-color: var(--primary-black);
        box-shadow: var(--shadow-card);
        height: var(--card-height-active);
        transition:
          background-color var(--transition-fast),
          box-shadow var(--transition-fast),
          height var(--transition-fast);

        h3,
        p {
          color: var(--secondary-white);
        }

        /* Filter stylet af Copilot */
        .icon {
          filter: brightness(0) saturate(100%) invert(84%) sepia(46%) saturate(1549%) hue-rotate(359deg) brightness(102%) contrast(104%);
        }
      }
    }

    .icon-wrapper {
      display: flex;
      align-items: flex-start;
    }

    .icon {
      width: var(--icon-size-md);
      height: var(--icon-size-md);
      display: inline-block;
      flex-shrink: 0;

      :global(svg) {
        width: 100%;
        height: 100%;
      }
    }

    @container cards (width > 1200px) {
      .card-scroller {
        overflow-x: visible;
        scroll-snap-type: none;
        padding-inline: 0;
        padding-bottom: 0;
      }

      ul {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--flow-xxl);
        max-width: var(--content-width);
        margin: 0 auto;
        padding-inline: 0;
        padding-block: 0;

        &::after {
          display: none;
        }
      }

      li {
        width: auto;
        height: auto;
        scroll-snap-align: none;

        &.active-card {
          background-color: var(--secondary-light-grey);
          box-shadow: none;
          height: auto;

          h3,
          p {
            color: var(--primary-black);
          }

          .icon {
            filter: none;
          }
        }

        &:nth-child(2) {
          padding: var(--flow-xxl);
          background-color: var(--primary-black);

          h3,
          p {
            color: var(--secondary-white);
          }

          .icon {
            filter: brightness(0) saturate(100%) invert(84%) sepia(46%) saturate(1549%) hue-rotate(1deg) brightness(102%) contrast(104%);
          }
        }

        &:nth-child(3),
        &:nth-child(4) {
          padding: 2.8125rem 2.4375rem;
        }

        &:nth-child(4) {
          padding-top: 2.3125rem;
        }
      }
    }
  }
</style>
